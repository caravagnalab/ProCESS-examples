---
title: "SPN03_Border_Growth"
output: html_document
---

```{r setup, include=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

```{r include=FALSE, warning=FALSE}
library(rRACES)
library(dplyr)
library(patchwork)
```

![](SPN03.png)

## Tissue simulation

```{r}
sim <- new(Simulation, seed = 12345)
sim$duplicate_internal_cells <- FALSE
sim$death_activation_level <- 50
```

Add Clone1

```{r}
sim$add_mutant(name = "Clone 1", growth_rates = 0.1, death_rates = 0.01)
sim$place_cell("Clone 1", 500, 500)
sim$run_up_to_size("Clone 1", 2000)
```

Get SampleA

```{r}
bbox <- sim$search_sample(c("Clone 1" = 200), 20, 20)
sim$sample_cells("A", bbox$lower_corner, bbox$upper_corner)
t1 <- plot_tissue(sim)
t1
```

Add Clone2

```{r}
sim$add_mutant(name = "Clone 2", growth_rates = 0.5, death_rates = 0.01)
sim$mutate_progeny(sim$choose_cell_in("Clone 1"), "Clone 2")
sim$run_up_to_size(species = 'Clone 2', 1000)
```

Get SampleB

```{r}
bbox <- sim$search_sample(c("Clone 1" = 160, 'Clone 2' = 40), 40, 40)
sim$sample_cells("B", bbox$lower_corner, bbox$upper_corner)
t2 <- plot_tissue(sim)
t2
```

```{r warning=FALSE}
plot_muller(sim)
```

Continue growth on Clone2

```{r}
sim$update_rates(species = "Clone 1", rates = c(growth = 0.0001, death = 0.01))
sim$run_up_to_size(species = 'Clone 2', 5000)
plot_muller(sim)
```

Get SampleC

```{r}
bbox <- sim$search_sample(c('Clone 2' = 200), 20, 20)
sim$sample_cells("C", bbox$lower_corner, bbox$upper_corner)
t3 <- plot_tissue(sim)
t3
```

Add Clone3

```{r}
sim$add_mutant(name = "Clone 3", growth_rates = 0.8, death_rates = 0.01)
sim$mutate_progeny(sim$choose_cell_in("Clone 2"), "Clone 3")
sim$run_up_to_size("Clone 3", 5000)
```

Get SampleD

```{r}
bbox <- sim$search_sample(c("Clone 2" = 120, 'Clone 3' = 80), 40, 40)
sim$sample_cells("D", bbox$lower_corner, bbox$upper_corner)
t4 <- plot_tissue(sim)
t4
```

Plot muller

```{r}
muller <- plot_muller(sim)
muller
```

Get Forest

```{r}
forest <- sim$get_samples_forest()
plt_forest <- plot_forest(forest) %>%
  annotate_forest(forest)
plt_forest
```

And other statistics

```{r}
piechart <- plot_state(sim)
timeseries <- plot_timeseries(sim)
piechart + timeseries
```
